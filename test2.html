<html>
<meta name="viewport" content = 
	"width = device-width, initial-scale=1, maximum-scale=1" />
<script src="scripts/jquery.js"></script>
<style type="text/css">
#overlay, #photo {
    position: static;
    width: 204px;
}

#overlay {
/*    -webkit-transition: opacity 1s ease-in-out;*/
    -webkit-transition: background-color 1s ease-in-out;
    -webkit-transition: all 1s ease-in-out; 
/*    -webkit-transition: -webkit-transform 1s ease-in-out; */
    -webkit-transform-origin: -0% 0%;
    -webkit-transform: translate(0px, 0px) scale(0.4);
    position: fixed;
    top:0;
    bottom: 0;
    left:0;
    right: 0;
    display: block;
    opacity: 0;
    border: 0px solid red;
    width: auto;
    height: auto;
    background-color: transparent;
}

#overlay img {
	position: absolute;
	left: 0; right: 0;
	top: 0; bottom: 0;
	margin: auto;
}

#debug {
    position: none;
    width: 300;
    height: 100;
    top: 0; left: 0;
    background-color: gray;
}

</style>
<body>

<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<p>
<img id="photo" src="content/barn.thumb.jpg"/>
<div id="overlay"><img src="content/barn.thumb.jpg"/></div>
</p>
<h3>some text after the zooming</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>
<h3>zooming test</h3>

<div id="debug">debug</div>

<script type="text/javascript">
var zoomed = false;

var fullImageWidth = 500;
var thumbImageWidth = 204;
var fract = thumbImageWidth/fullImageWidth;
var thumbImageHeight = 135;
var fullImageHeight = 333;
var overlay = document.getElementById("overlay");


function toggle() {
	if(zoomed) {
		shrink();
	} else {
		grow();
	}
}


function grow() {	
    var scale = 0.4;
    var pos = $("#photo").offset();
    var scrolltop = $("body").scrollTop();

	//zphoto.top = (window.height-zphoto.height)/2 * scale;
	//h = photo.top - zphoto.top
	var zpt = (window.innerHeight-fullImageHeight)/2*scale;
    var phototop = pos.top - scrolltop;
    var h = phototop-zpt;

	//zphoto.left = (window.width - zphoto.width)/2 * scale;
	var zpl = (window.innerWidth-fullImageWidth)/2*scale;
	//w = photo.left - zphoto.left;
    var photoleft = pos.left;
    var w = photoleft- zpl;

    overlay.style.webkitTransitionDuration = "0s";
    overlay.style.webkitTransform =  'translate('+w+'px, '+h+'px) scale(0.4)';
    
    overlay.style.opacity = "1";
    

    //var t = pos.top - scrolltop + $("#photo").height()/2;
    //var per = t/(window.innerHeight);
    //overlay.style.webkitTransformOrigin = "-4% " + (per*100)+"%";
    //overlay.style.webkitTransformOrigin = "-4% " + (per*100)+"%";
/*    overlay.style.top = 0;
    overlay.style.bottom = 0;
    overlay.style.left = 0;
    overlay.style.right = 0;*/
    //overlay.style.visibility = "visible";
    
    //var sx = window.innerWidth/overlay.offsetWidth;
    //var sy = window.innerHeight/overlay.offsetHeight;
    //var s = Math.min(sx,sy);
    //var s = 1;
    setTimeout(function(){
	    overlay.style.webkitTransitionDuration = "0.3s";
	    overlay.style.backgroundColor = "white";
	    overlay.style.webkitTransform ='translate(0px,0px) scale(1)';
	    //overlay.style.webkitTransform ='translateX(0px) scale(0.5)';
	    zoomed = true;
    
    },10);
    
};

function shrink() {
    var scale = 0.4;
    var pos = $("#photo").offset();
    var scrolltop = $("body").scrollTop();

	//zphoto.top = (window.height-zphoto.height)/2 * scale;
	//h = photo.top - zphoto.top
	var zpt = (window.innerHeight-fullImageHeight)/2*scale;
    var phototop = pos.top - scrolltop;
    var h = phototop-zpt;

	//zphoto.left = (window.width - zphoto.width)/2 * scale;
	var zpl = (window.innerWidth-fullImageWidth)/2*scale;
	//w = photo.left - zphoto.left;
    var photoleft = pos.left;
    var w = photoleft- zpl;

    overlay.style.webkitTransform =  'translate('+w+'px, '+h+'px) scale(0.4)';

    overlay.style.backgroundColor = "transparent";
    zoomed = false;
}

$("#photo").click(toggle);
$("#overlay").click(toggle);


document.getElementById("overlay").addEventListener('webkitTransitionEnd',
 function( event ) {
    if(!zoomed) {
	    //console.log("hiding");
	    //overlay.style.display = "none";
	    overlay.style.opacity = "0";
	    //overlay.style.backgroundColor = "transparent";
        //overlay.style.visibility = "hidden";
    } else {
    }
}, false );

document.getElementById("debug").innerHTML = "debug is live";

var pho = document.getElementById("photo");
pho.addEventListener('gestureend',function(e){
        document.getElementById("debug").innerHTML = " " + e.scale;
        if(e.scale > 2) {
            toggle();
        }
});

document.getElementById("overlay").addEventListener('gestureend',function(e){
        document.getElementById("debug").innerHTML = " " + e.scale;
        if(e.scale < 0.8) {
            toggle();
        }
});

</script>
</body>
</html>
